<!DOCTYPE html>
<html lang="ko">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>카멘 격돌 연습</title>
	<style>
		html, body { padding: 0; margin: 0; background-color: grey; }
		.circle { position: absolute; top: 50%; left: 50%; width: 600px; height: 600px; }
		.circle > div { position: absolute; top: 0; left: 0; transform: translate(-50%, -50%); }
		.circle .inner {
			/* border: 18px solid #59e4ff;
			border-radius: 100%; */
			width: 300px;
			height: 300px;
			border: 18px solid #7fffff;
			border-radius: 50%;
			/* background-image: linear-gradient(transparent, transparent), linear-gradient(140deg, rgba(127,255,255,1) 0%, rgba(248,255,255,1) 50%, rgba(127,255,255,1) 100%);
			background-origin: border-box;
			background-clip: content-box, border-box; */
			
			/* background: rgb(127,255,255);
			background: linear-gradient(140deg, rgba(127,255,255,1) 0%, rgba(248,255,255,1) 100%); */
		}
		.circle .outer {
			border: 6px solid #59e4ff;
			border-radius: 50%;
			width: 600px; height: 600px;
			/* animation: shrink 1s linear; */
		}
		.circle.bad .outer {
			border-color: red;
		}
		.circle.perfect .outer {
			border-color: #e3b274;
		}
		.circle.perfect:before {
			display: block;
			content: "";
			position: absolute; top: 0; left: 0; transform: translate(-50%, -50%);
			border: 10px solid #e3b274;
			border-radius: 50%;
			width: 300px; height: 300px;
			animation: fadeOutScale 0.5s;
		}

		.circle .key {
			background-color: #f4e7c6;
			color: #7d5a1c;
			font-weight: bold;
			border-radius: 10px;
			width: 60px;
			height: 60px;
			display: flex;
			justify-content: center;
    		align-items: center;
			font-size: 34px;
		}
		.circle.bad .result {
			text-shadow: 0px 0px 5px red,0px 0px 10px red,0px 0px 15px red;
		}
		.circle.perfect .result {
			text-shadow: 0px 0px 5px rgba(125, 90, 28, 1),0px 0px 10px rgba(125, 90, 28, 1),0px 0px 15px rgba(125, 90, 28, 1);
		}
		.circle .result {
			color: white;
			top: 170px;
			transform: translate(-50%, -50%);
			font-weight: bold;
			display: flex;
			justify-content: center;
    		align-items: center;
			font-size: 54px;
		}

		#score {
			font-size: 24px;
			font-weight: bold;
			padding: 20px;
		}

		@keyframes fadeOut {
			from {
				opacity: 1;
			}

			to {
				opacity: 0;
			}
		}
		@keyframes fadeOutScale {
			from {
				opacity: 1;
				width: 300px;
				height: 300px;
			}

			to {
				opacity: 0;
				width: 500px;
				height: 500px;
			}
		}
	</style>
</head>
<body>
	<!-- <div class="circle">
		<div class="outer"></div>
		<div class="inner"></div>
	</div> -->
	<div id="score">Perfect: <span id="score_perfect">0</span><br />Bad: <span id="score_bad">0</span></div>
	<script>
		let score_perfect = 0;
		let score_bad = 0;

		function updateScore() {
			document.getElementById("score_perfect").textContent = score_perfect;
			document.getElementById("score_bad").textContent = score_bad;
		}

		function getRandomInt(min, max) {
			min = Math.ceil(min);
			max = Math.floor(max);
			return Math.floor(Math.random() * (max - min + 1)) + min;
		}

		class Circle {
			constructor() {
				this.play = true;
				this.size = 600;
				this.currentSize;
				this.duration = 1500;
				this.progress;
				this.failTimer = setTimeout(() => {
					this.end("bad");
				}, this.duration);

				const x = getRandomInt(this.size, window.innerWidth - this.size);
				const y = getRandomInt(this.size, window.innerHeight - this.size);

				this.wrapper = document.createElement("div");
				this.wrapper.classList.add("circle");
				this.inner = document.createElement("div");
				this.inner.classList.add("inner");
				this.outer = document.createElement("div");
				this.outer.classList.add("outer");
				this.key = document.createElement("div");
				this.key.classList.add("key");
				this.wrapper.append(this.inner, this.outer, this.key);
				this.wrapper.style.top = y + "px";
				this.wrapper.style.left = x + "px";
				document.body.append(this.wrapper);
				this.animate();
				this.setKeydown();
			}

			setKeydown() {
				const keys = ['Q', 'W', 'E', 'R', 'A', 'S', 'D', 'F'];
				const randomKey = keys[Math.floor(Math.random() * keys.length)];
				this.key.textContent = randomKey;
				document.addEventListener('keydown', (event) => {
					if (event.key.toUpperCase() === randomKey) {
						this.catch();
					}
				});
			}

			catch() {
				if (!this.play) return;

				if (this.currentSize <= 350 && this.currentSize >= 280) {
					this.end("perfect");
				} else {
					this.end("bad");
				}
			}

			end(result = "bad") {
				this.play = false;
				clearTimeout(this.failTimer);

				this.result = document.createElement("div");
				this.result.classList.add("result");
				this.wrapper.append(this.result);

				if (result == "perfect") {
					this.wrapper.classList.add("perfect");
					this.result.textContent = "Perfect";
					score_perfect++;
				} else {
					this.wrapper.classList.add("bad");
					this.result.textContent = "Bad";
					score_bad++;
				}
				updateScore();
				// this.wrapper.style.animation = "fadeOut 0.5s";
				setTimeout(() => {
					this.wrapper.style.transition = "opacity 0.5s";
					this.wrapper.style.opacity = "0";
				}, 500);
				setTimeout(() => {
					this.wrapper.remove();
				}, 1000);
			}

			shrink(timestamp) {
				if (!this.play) return;
				if (!this.startTimestamp) this.startTimestamp = timestamp;
				this.progress = (timestamp - this.startTimestamp) / this.duration;
    			this.currentSize = this.size - (this.size * Math.min(this.progress, 1));
				this.outer.style.width = this.currentSize + "px";
				this.outer.style.height = this.currentSize + "px";
				if (this.progress < 1) {
					this.animationId = requestAnimationFrame((timestamp) => this.shrink(timestamp));
			    }
			}
			animate() {
				this.animationId = requestAnimationFrame((timestamp) => this.shrink(timestamp));
			}
		}

		setTimeout(() => {
			new Circle();
			setInterval(() => {
				new Circle();
				if (getRandomInt(0, 2) == 0) {
					setTimeout(() => {
						new Circle();
					}, 250);
				}
			}, 5800);
		}, 1000);

		// setTimeout(() => {
		// 	new Circle(900, 900);
		// }, 1000);
		// function makeCircle(x = 0, y = 0) {
		// 	const circle = document.createElement("div");
		// 	circle.classList.add("circle");
		// 	const outer = document.createElement("div");
		// 	outer.classList.add("outer");
		// 	const inner = document.createElement("div");
		// 	inner.classList.add("inner");
		// 	circle.append(outer, inner);
		// 	circle.style.x = x + "px";
		// 	circle.style.y = y + "px";
		// 	document.body.append(circle);
		// 	outer.style.animation = "shrink 1s linear";
		// 	setTimeout(() => {
		// 		circle.classList.add("bad");
		// 	}, 500);
		// }
		// setInterval(() => {
		// 	console.log("A");
		// 	makeCircle(900, 900);
		// }, 5800);
		// setTimeout(() => {
		// 	makeCircle(900, 900);
		// }, 100);
		// setTimeout(() => {
		// 	const co = document.querySelector(".circle .outer");
		// }, 1000);
		// function makeCircle(x, y) {
		// 	const innerCircle = 
		// }
		// const co = document.querySelector(".circle .outer");
		// console.log(co);
		// setInterval(() => {
		// 	console.log("A");
		// 	const co = document.querySelector(".circle .outer");
		// 	co.style.width = co.style.width.replace("px", "") * 1 - 10 + "px";
		// }, 100);
	</script>
</body>
</html>
